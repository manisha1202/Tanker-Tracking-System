<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>

<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="HandheldFriendly" content="true">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MagicEye</title>
    <meta name="description" content="MagicEye">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="track.png">  

    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css">
    <!-- <link rel="stylesheet" href="assets/css/bootstrap-select.less"> -->

    <link rel="stylesheet" href="assets/scss/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

<style>
/* Tablet Landscape */
@media screen and (max-width: 1060px) {
    #primary { width:67%; }
    #secondary { width:30%; margin-left:3%;}  
}
/* Tabled Portrait */
@media screen and (max-width: 768px) {
    #primary { width:100%; }
    #secondary { width:100%; margin:0; border:none; }
}
</style>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->

</head>
<body>
<script>
	var config = {
    apiKey: "AIzaSyBXsMfKFhI9_E4zu1CyZq77EJb91aZ5h2c",
    authDomain: "tankers-lorry.firebaseapp.com",
    databaseURL: "https://tankers-lorry.firebaseio.com",
    projectId: "tankers-lorry",
    storageBucket: "tankers-lorry.appspot.com",
    messagingSenderId: "29663184650"
  };
  firebase.initializeApp(config);
	</script>
        <!-- Left Panel -->

    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">

            <div class="navbar-header">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
                <h2 style="color:white; font-family:Georgia; margin:7px;">MagicEye</h2>
           <!--    <a class="navbar-brand" href="./"><img src="images/logo.png" alt="Logo"></a>
                <a class="navbar-brand hidden" href="./"><img src="images/logo2.png" alt="Logo"></a>  -->  
              
            </div>

            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="index.html"> <i class="menu-icon fa fa-dashboard"></i>Dashboard </a>
                    </li>
                    <h3 class="menu-title">UI elements</h3><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                    
              
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-bar-chart"></i>Charts</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-line-chart"></i><a href="charts-chartjs.html">Chart JS</a></li>
                        <!--     <li><i class="menu-icon fa fa-area-chart"></i><a href="charts-flot.html">Flot Chart</a></li>
                            <li><i class="menu-icon fa fa-pie-chart"></i><a href="charts-peity.html">Peity Chart</a></li>  -->
                        </ul>
                    </li>

                    <li class="menu-item-has-children active dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-area-chart"></i>Maps</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-map-o"></i><a href="maps-gmap.html">Google Maps</a></li>
                        </ul>
                    </li>
                
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside><!-- /#left-panel -->

    <!-- Left Panel -->

    <!-- Right Panel -->

    <div id="right-panel" class="right-panel">

        
        <!-- Header-->

        <div class="breadcrumbs">
            <div class="col-sm-4">
                <div class="page-header float-left">
                    <div class="page-title">
                        <h1>Tanker's Tracker</h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="page-header float-right">
                    <div class="page-title">
                        <ol class="breadcrumb text-right">
                            <li><a href="index.html">Dashboard</a></li>
                            <li><a href="#">Map</a></li>
                            <li class="active">Gmap</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="content mt-3">
         

                    <div class="row">  
                                <div class="card-header" style="background-color:#ffc266 !important;">
                                    <h4>Map</h4>
                                </div>
                                <div class="gmap_unix card-body">
                                    <div class="map" id="map"></div>
                                </div>
                         
                     </div>  
                    <!-- /# row -->
</div><!-- .content -->

  <audio id="myAudio">
	<source src="Audio/Siren_Noise-KevanGC-1337458893.mp3" type="audio/mp3">
	</audio>
           
    <script>
    window.onload = function () {
	var lat;
	  var longt;
	  var yVal1;
	  var dbref5=firebase.database().ref().child('LOCK');
	  function initMap() {
		  var myCenter = new google.maps.LatLng( lat ,longt);
		   /* var geocoder  = new google.maps.Geocoder();
        	
        	geocoder.geocode({'latLng': myCenter}, function (results, status) {
        		if(status == google.maps.GeocoderStatus.OK) {           
        		var add=results[0].formatted_address;         
        		console.log(add);
        		}
        	});*/
			var mapProp = {center:myCenter, zoom:15, scrollwheel:true, draggable:true, mapTypeId:google.maps.MapTypeId.ROADMAP};
			var map = new google.maps.Map(document.getElementById("map"),mapProp);
			var marker = new google.maps.Marker({position:myCenter});
			marker.setMap(map);
      }
	var updateValue=function(){
		var dbref = firebase.database().ref().child('CURRGPS').child('LATITUDE');
		  
		dbref.on('value',function(snap){
			var val=snap.val();
			var deg=val.split("°");
			var min=deg[1].split("'");
			var degnum=parseFloat(deg[0]);
			var minnum=parseFloat(min[0].trim());
			var secnum=parseFloat(min[1].trim());
			lat=degnum+(minnum/60)+(secnum/3600);

		});
		var dbref1 = firebase.database().ref().child('CURRGPS').child('LONGITUDE');
		
		dbref1.on('value',function(snap){
			 var val1=snap.val();
			var deg=val1.split("°");
			var min=deg[1].split("'");
			var degnum=parseFloat(deg[0]);
			var minnum=parseFloat(min[0].trim());
			var secnum=parseFloat(min[1].trim());
			longt=degnum+(minnum/60)+(secnum/3600);

			initMap();
			console.log("pre");
			dbref5.on('value',function(snap){
          	  console.log("hello world!");
          	 var val=snap.val();
          	 
          	 for (j1 in val) {
          	 yVal1=val[j1];
          	 }
          	 console.log("before init");
          	 init();
          	 console.log("after init");
          	 
          	 
          	
            });
		});
		function init(){
			console.log(lat);
			console.log(longt);
			var geocoder  = new google.maps.Geocoder();
    		var myCenter = new google.maps.LatLng( lat ,longt);
    		geocoder.geocode({'latLng': myCenter}, function (results, status) {
    			if(status == google.maps.GeocoderStatus.OK) {           
    			add=results[0].formatted_address;         
    			console.log(add);
    			
    			console.log(add);
             	 if(yVal1==0){
             		 var x = document.getElementById("myAudio"); 
             		    x.play(); 
             	
             		 window.alert("CAUTION - Unlocked!!!"+"\n"+"\n"+ "TIME:  "+(new Date(parseFloat(j1)))+"\n"+"\n"+"LOCATION: "+ add);
             		 
             	 }
    		}
    	});

		}
	}
      
	  
	  updateValue();
    }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmy_ADPQnYEMV71hUxbHoliDXD2PH8Vwo&callback=initMap">
    </script>
    </div><!-- /#right-panel -->

    <!-- Right Panel -->


    <script src="assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Gmaps -->
   <!-- 
  <script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2jlT6C_to6X1mMvR9yRWeRvpIgTXgddM"></script>
    <script src="assets/js/lib/gmap/gmaps.js"></script>
    <script src="assets/js/lib/gmap/gmap.init.js"></script>  -->
    
    

</body>
</html>
